<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SHAM University - Exam Attendance</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4">

  <div class="bg-white shadow-2xl rounded-xl p-8 w-full max-w-3xl">
    <h1 class="text-4xl font-extrabold text-center mb-6 text-blue-700">üéì SHAM University Exam Attendance</h1>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">Enter Student ID</label>
      <input type="text" id="studentId" maxlength="4" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="e.g. 1001" />
    </div>

    <button onclick="verifyStudent()" class="mt-2 w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 rounded-lg shadow-md">
      ‚úÖ Mark Attendance
    </button>

    <div id="result" class="mt-6"></div>
  </div>

  <script>
    const students = [
      { ID: "1001", Name: "Ali Raza", Eligibility: "eligible", Reason: "", Subject: "Mathematics", Seat: "4,E" },
      { ID: "1002", Name: "Fatima Noor", Eligibility: "not eligible", Reason: "Fee not paid", Subject: "Physics", Seat: "7,B" },
      { ID: "1003", Name: "Hassan Ali", Eligibility: "eligible", Reason: "", Subject: "Chemistry", Seat: "3,A" },
      { ID: "1004", Name: "Maria Khan", Eligibility: "not eligible", Reason: "Missing documents", Subject: "Biology", Seat: "5,D" },
      { ID: "1005", Name: "Ahmed Bilal", Eligibility: "eligible", Reason: "", Subject: "English", Seat: "6,C" }
    ];

    const storageKey = 'attendance_csv_storage';
    const attendanceData = loadFromLocalStorage();

    function getCurrentTimestamp() {
      const now = new Date();
      return now.toLocaleString();
    }

    function verifyStudent() {
      const studentId = document.getElementById("studentId").value.trim();
      const resultDiv = document.getElementById("result");

      const student = students.find(s => s.ID === studentId);
      if (!student) {
        resultDiv.innerHTML = `<p class="text-red-600 font-semibold">‚ùå Student not found</p>`;
        return;
      }

      const alreadyMarked = attendanceData.find(a => a.ID === studentId);
      if (alreadyMarked) {
        resultDiv.innerHTML = `<p class="text-yellow-600 font-semibold">‚ö†Ô∏è Attendance already marked for ${student.Name}</p>`;
        return;
      }

      if (student.Eligibility === "not eligible") {
        resultDiv.innerHTML = `
          <div class="bg-red-100 p-4 rounded border border-red-400">
            <p><strong>Name:</strong> ${student.Name}</p>
            <p><strong>Status:</strong> ‚ùå Not Eligible</p>
            <p><strong>Reason:</strong> ${student.Reason}</p>
            <p><strong>Subject:</strong> ${student.Subject}</p>
            <p><strong>Seat:</strong> ${student.Seat}</p>
          </div>`;
        return;
      }

      const record = {
        ID: student.ID,
        Name: student.Name,
        ExamName: student.Subject,
        Eligibility: student.Eligibility,
        IsPresent: "true",
        Timestamp: getCurrentTimestamp(),
        Seat: student.Seat
      };

      attendanceData.push(record);
      saveToLocalStorage();

      resultDiv.innerHTML = `
        <div class="bg-green-100 p-4 rounded border border-green-400">
          <p><strong>Name:</strong> ${student.Name}</p>
          <p><strong>Subject:</strong> ${student.Subject}</p>
          <p><strong>Seat:</strong> ${student.Seat}</p>
          <p class="text-green-700 font-bold mt-2">‚úÖ Attendance marked successfully</p>
        </div>`;
    }

    function saveToLocalStorage() {
      localStorage.setItem(storageKey, JSON.stringify(attendanceData));
    }

    function loadFromLocalStorage() {
      const stored = localStorage.getItem(storageKey);
      return stored ? JSON.parse(stored) : [];
    }

    window.addEventListener('load', () => {
      if (!localStorage.getItem('csv_created')) {
        localStorage.setItem('csv_created', 'yes');
        saveToFile();
      }
    });

    function saveToFile() {
      const csvHeader = "ID,Name,ExamName,Eligibility,IsPresent,Timestamp,Seat";
      const csvRows = attendanceData.map(row =>
        [row.ID, row.Name, row.ExamName, row.Eligibility, row.IsPresent, row.Timestamp, row.Seat].join(",")
      );
      const csvContent = [csvHeader, ...csvRows].join("\n");
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = "attendance_record.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>

</body>
</html>
